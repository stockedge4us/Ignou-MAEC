<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ subject }} - Book Mode</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { 
      background: linear-gradient(135deg, #1a1208 0%, #2d1810 100%);
      height:100vh; overflow:hidden; display:flex; 
      justify-content:center; align-items:center; 
      perspective:3000px; font-family:'Bookman Old Style',Georgia,serif;
    }
    
    .book { 
      position:relative; width:1000px; height:700px; 
      transform-style:preserve-3d; 
      transform:rotateY(-15deg) rotateX(5deg);
      transition:transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
      filter:drop-shadow(0 25px 50px rgba(0,0,0,0.8));
    }
    
    .page { 
      position:absolute; width:500px; height:700px; 
      background: linear-gradient(to right, #fdfbf7 0%, #ffffff 50%, #fdfbf7 100%);
      backface-visibility:hidden; padding:50px 45px; 
      overflow-y:auto; line-height:1.9; font-size:15px;
      border:1px solid #e8d7c3;
      box-shadow: inset 0 0 30px rgba(139,69,19,0.03);
    }
    
    .page.left  { 
      left:0; transform-origin:right center;
      border-right:3px solid #c9a876;
      background: linear-gradient(to left, #fdfbf7 0%, #ffffff 50%, #f8f6f2 100%);
    }
    
    .page.right { 
      left:500px; transform-origin:left center;
      border-left:3px solid #c9a876;
    }
    
    .page::-webkit-scrollbar { width:8px; }
    .page::-webkit-scrollbar-track { background:#f5f0e8; border-radius:4px; }
    .page::-webkit-scrollbar-thumb { background:#c9a876; border-radius:4px; }
    
    .page h3 { 
      color:#6b3410; font-size:20px; font-weight:600;
      border-bottom:3px solid #d4af37; 
      padding-bottom:12px; margin-bottom:20px;
      text-transform:uppercase; letter-spacing:1px;
    }
    
    .page p strong { 
      color:#2c1810; font-size:16px; 
      display:block; margin-bottom:15px;
      line-height:1.6;
    }
    
    .answer-text { 
      background: linear-gradient(135deg, #fffdf8 0%, #faf7f0 100%);
      padding:25px; 
      border-left:5px solid #d4af37;
      border-radius:4px; 
      margin:20px 0;
      box-shadow:0 2px 8px rgba(139,69,19,0.08);
      color:#3a2a1a;
    }
    
    .page-number { 
      text-align:center; color:#a0826d; 
      margin-top:60px; font-style:italic; 
      font-size:14px; font-weight:500;
    }

    button { 
      position:fixed; top:30px; z-index:100; 
      padding:15px 30px; 
      background: linear-gradient(135deg, #8b4513 0%, #6b3410 100%);
      color:white; border:none; 
      border-radius:50px; font-size:15px; 
      cursor:pointer; font-weight:600;
      box-shadow:0 6px 20px rgba(139,69,19,0.4);
      transition:all 0.3s ease;
      text-transform:uppercase; letter-spacing:1px;
    }
    
    button:hover { 
      transform:translateY(-2px); 
      box-shadow:0 8px 25px rgba(139,69,19,0.6);
      background: linear-gradient(135deg, #a0522d 0%, #8b4513 100%);
    }
    
    button:active { transform:translateY(0); }
    
    #prevBtn { left:30px; }
    #nextBtn { right:30px; }

    @media (max-width:1100px) {
      .book { 
        transform:none; width:100%; height:100vh; 
        max-width:600px; filter:none;
      }
      .page { 
        width:100% !important; left:0 !important; 
        height:100%; padding:30px 25px; font-size:15px; 
        border:none;
      }
      .page.right { display:none; }
      button { top:15px; padding:12px 20px; font-size:14px; }
      #prevBtn { left:15px; }
      #nextBtn { right:15px; }
    }

    /* Subtle paper texture */
    .page::before {
      content:'';
      position:absolute; top:0; left:0; right:0; bottom:0;
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(139,69,19,0.02) 2px, rgba(139,69,19,0.02) 4px);
      pointer-events:none;
    }

    /* Cover page styles */
    .cover-page {
      background: linear-gradient(135deg, #8b4513 0%, #6b3410 100%);
      color:white;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      padding:60px 40px;
    }

    .cover-page::before {
      background-image: 
        repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.03) 10px, rgba(255,255,255,0.03) 20px);
    }

    .cover-title {
      font-size:42px;
      font-weight:700;
      margin-bottom:30px;
      text-shadow:2px 2px 4px rgba(0,0,0,0.3);
      line-height:1.3;
    }

    .cover-subtitle {
      font-size:18px;
      opacity:0.9;
      margin-bottom:20px;
      font-style:italic;
    }

    .cover-logo {
      margin-top:40px;
      padding:20px 40px;
      border:3px solid rgba(255,255,255,0.3);
      border-radius:10px;
      font-size:16px;
      font-weight:600;
      letter-spacing:2px;
    }
  </style>
</head>
<body>

<button id="prevBtn">‚Üê Previous</button>
<button id="nextBtn">Next ‚Üí</button>

<div class="book" id="book">
  <!-- Cover page -->
  <div class="page left cover-page">
    <div class="cover-title">{{ subject }}</div>
    <div class="cover-subtitle">Complete Study Guide</div>
    <div class="cover-logo">IGNOU EXAM PREP</div>
    <div style="margin-top:50px; font-size:14px; opacity:0.8;">
      Interactive eBook Edition
    </div>
  </div>

  <!-- Generate pages in pairs (left + right) -->
  {% set page_num = [0] %}
  {% for section, questions in sections.items() %}
    {% for q in questions %}
      {% if page_num[0] % 2 == 0 %}
        <!-- Left page -->
        <div class="page left">
          <h3>{{ section }}</h3>
          <p><strong>{{ q }}</strong></p>
          <div class="answer-text">
            {% if answers.get(q) %}
              <div style="white-space:pre-wrap;">{{ answers.get(q) }}</div>
            {% else %}
              <em style="color:#999;">No answer yet</em>
            {% endif %}
          </div>
          <div class="page-number">Page {{ page_num[0] + 1 }}</div>
        </div>
      {% else %}
        <!-- Right page -->
        <div class="page right">
          <h3>{{ section }}</h3>
          <p><strong>{{ q }}</strong></p>
          <div class="answer-text">
            {% if answers.get(q) %}
              <div style="white-space:pre-wrap;">{{ answers.get(q) }}</div>
            {% else %}
              <em style="color:#999;">No answer yet</em>
            {% endif %}
          </div>
          <div class="page-number">Page {{ page_num[0] + 1 }}</div>
        </div>
      {% endif %}
      {% if page_num.append(page_num.pop() + 1) %}{% endif %}
    {% endfor %}
  {% endfor %}

  <!-- Final end page -->
  <div class="page left" style="text-align:center; padding-top:220px;">
    <h2 style="color:#6b3410; font-size:28px; margin-bottom:20px;">End of Book</h2>
    <p style="font-size:19px; color:#8b6f47; font-style:italic;">Keep learning ‚Äî you're doing amazing!</p>
    <div style="margin-top:40px; color:#a0826d; font-size:14px;">
      <p>üìö Study well ‚Ä¢ Practice regularly ‚Ä¢ Succeed always</p>
    </div>
  </div>
</div>

<script>
  let currentPage = 0;
  const book = document.getElementById('book');
  const pages = document.querySelectorAll('.page');
  const totalPages = pages.length;

  function updateBook() {
    const rotation = -15 - (currentPage * 0.5);
    book.style.transform = `rotateY(${rotation}deg) rotateX(5deg)`;
    
    // Hide/show pages for performance
    pages.forEach((page, index) => {
      if (Math.abs(index - currentPage) > 4) {
        page.style.display = 'none';
      } else {
        page.style.display = 'block';
      }
    });
  }

  document.getElementById('nextBtn').onclick = () => {
    if (currentPage < totalPages - 2) {
      currentPage += 2;
      updateBook();
    }
  };

  document.getElementById('prevBtn').onclick = () => {
    if (currentPage > 0) {
      currentPage -= 2;
      updateBook();
    }
  };

  // Keyboard support
  document.addEventListener('keydown', e => {
    if (e.key === 'ArrowRight' || e.key === 'Right') {
      document.getElementById('nextBtn').click();
    }
    if (e.key === 'ArrowLeft' || e.key === 'Left') {
      document.getElementById('prevBtn').click();
    }
  });

  // Touch swipe support for mobile
  let touchStartX = 0;
  let touchEndX = 0;

  book.addEventListener('touchstart', e => {
    touchStartX = e.changedTouches[0].screenX;
  });

  book.addEventListener('touchend', e => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  });

  function handleSwipe() {
    if (touchEndX < touchStartX - 50) {
      document.getElementById('nextBtn').click();
    }
    if (touchEndX > touchStartX + 50) {
      document.getElementById('prevBtn').click();
    }
  }

  // Initialize
  updateBook();
</script>

</body>
</html>
